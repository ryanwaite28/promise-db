!function(){if(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!window.indexedDB)return void console.log("indexedDB not supported...");const n=function(n){let t=this;t.get_db=function(){return n},t.stores=function(n){if(!t.get_db().objectStoreNames.contains(n)){let t="this store does not exist in current database version: "+n;throw console.log(t),new Error(t)}return new function(n,t){this.get_store=function(){return n.transaction([t]).objectStore(t)},this.get_all=function(){return new Promise(function(e,r){var o=n.transaction([t]).objectStore(t).getAll();o.error=function(n){return r(n)},o.onsuccess=function(n){return e(n.target.result)}})},this.get_all_keys=function(){return new Promise(function(e,r){var o=n.transaction([t]).objectStore(t).getAllKeys();o.error=function(n){return r(n)},o.onsuccess=function(n){return e(n.target.result)}})},this.create=function(e){return new Promise(function(r,o){var u=n.transaction([t],"readwrite"),i=u.objectStore(t);u.onerror=function(n){return console.log(n),o("could not create",n)},u.oncomplete=function(n){return r(e)},e.uniqueValue&&e.uniqueValue.constructor===String&&e.uniqueValue.constructor===Number||(e.uniqueValue=String(Date.now())+Math.random().toString(36).substr(2,34)+Math.random().toString(36).substr(2,34)+Math.random().toString(36).substr(2,34)),i.add(e).onsuccess=function(n){}})},this.read=function(e){return new Promise(function(r,o){var u=n.transaction([t]).objectStore(t).get(e);u.error=function(n){return o(n)},u.onsuccess=function(n){return r(n.target.result)}})},this.update=function(e,r){return new Promise(function(o,u){var i=n.transaction([t],"readwrite").objectStore(t),c=i.get(e);c.error=function(n){return u(n)},c.onsuccess=function(n){r.uniqueValue&&delete r.uniqueValue;var t=Object.assign({},n.target.result,r),e=i.put(t);e.onerror=function(n){return u(n)},e.onsuccess=function(n){return o(n)}}})},this.destroy=function(e){return new Promise(function(r,o){var u=n.transaction([t],"readwrite").objectStore(t).delete(e);u.error=function(n){return o(n)},u.onsuccess=function(n){return r()}})},this.clear=function(e){return new Promise(function(e,r){var o=n.transaction([t],"readwrite").objectStore(t).clear();o.error=function(n){return r(n)},o.onsuccess=function(n){return e()}})},this.count=function(e){return new Promise(function(e,r){var o=n.transaction([t],"readwrite").objectStore(t).count();o.error=function(n){return r(n)},o.onsuccess=function(n){return e(o.result)}})}}(t.get_db(),n)}};window.IDB=function(t,e,r){let o=this;return new Promise(function(u,i){let c=!1;o.request=window.indexedDB.open(t,e),o.request.onupgradeneeded=function(t){var e=t.target.result;if(r&&r.constructor===Function&&r(t),1!=c)return c=!0,u(new n(e))},o.request.onerror=function(n){return i(n)},request.onsuccess=function(t){var e=t.target.result;if(r&&r.constructor===Function&&r(),1!=c)return c=!0,u(new n(e))}})}}();
