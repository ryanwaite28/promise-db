!function(){if(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!window.indexedDB)return void console.log("indexedDB not supported...");const t=function(t){let n=this;n.get_db=function(){return t},n.stores=function(t){if(!n.get_db().objectStoreNames.contains(t)){let n="this store does not exist in current database version: "+t;throw console.log(n),new Error(n)}return new function(t,n){this.get_store=function(){return t.transaction([n]).objectStore(n)},this.get_all=function(){return new Promise(function(e,r){var o=t.transaction([n]).objectStore(n).getAll();o.error=function(t){return r(t)},o.onsuccess=function(t){return e(t.target.result)}})},this.get_all_keys=function(){return new Promise(function(e,r){var o=t.transaction([n]).objectStore(n).getAllKeys();o.error=function(t){return r(t)},o.onsuccess=function(t){return e(t.target.result)}})},this.create=function(e){return new Promise(function(r,o){var u=t.transaction([n],"readwrite"),i=u.objectStore(n);u.onerror=function(t){return console.log(t),o("could not create",t)},u.oncomplete=function(t){return r(e)},e.constructor===Object&&(e.idb_uniqueValue&&e.idb_uniqueValue.constructor===String&&e.idb_uniqueValue.constructor===Number||(e.idb_uniqueValue=String(Date.now())+Math.random().toString(36).substr(2,34)+Math.random().toString(36).substr(2,34)+Math.random().toString(36).substr(2,34)),e.idb_createdDate=Date.now(),e.idb_updatedDate=Date.now()),i.add(e).onsuccess=function(t){}})},this.read=function(e){return new Promise(function(r,o){var u=t.transaction([n]).objectStore(n).get(e);u.error=function(t){return o(t)},u.onsuccess=function(t){return r(t.target.result)}})},this.update=function(e,r){return new Promise(function(o,u){var i=t.transaction([n],"readwrite").objectStore(n),c=i.get(e);c.error=function(t){return u(t)},c.onsuccess=function(t){r.idb_uniqueValue&&delete r.idb_uniqueValue,r.idb_updatedDate=Date.now();var n=Object.assign({},t.target.result,r),e=i.put(n);e.onerror=function(t){return u(t)},e.onsuccess=function(t){return o(n)}}})},this.destroy=function(e){return new Promise(function(r,o){var u=t.transaction([n],"readwrite").objectStore(n).delete(e);u.error=function(t){return o(t)},u.onsuccess=function(t){return r()}})},this.clear=function(e){return new Promise(function(e,r){var o=t.transaction([n],"readwrite").objectStore(n).clear();o.error=function(t){return r(t)},o.onsuccess=function(t){return e()}})},this.count=function(e){return new Promise(function(e,r){var o=t.transaction([n],"readwrite").objectStore(n).count();o.error=function(t){return r(t)},o.onsuccess=function(t){return e(o.result)}})}}(n.get_db(),t)}};window.IDB=function(n,e,r){let o=this;return new Promise(function(u,i){let c=!1;o.request=window.indexedDB.open(n,e),o.request.onupgradeneeded=function(n){if(!1===c){c=!0;var e=n.target.result,o=new t(e);return r&&r.constructor===Function&&r(n,o),u(o)}},o.request.onsuccess=function(n){if(!1===c){c=!0;var e=n.target.result,o=new t(e);return r&&r.constructor===Function&&r(!1,o),u(o)}},o.request.onerror=function(t){return i(t)}})}}();
